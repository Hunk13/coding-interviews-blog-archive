Find Median From Data Stream
============================

Oct 19, 2020 ¬∑ 3 min read

–ú–µ–¥–∏–∞–Ω–∞ ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∏—Ç –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–≤–µ –ø–æ–ª–æ–≤–∏–Ω—ã —Ç–∞–∫, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π –º–µ–Ω—å—à–µ, —á–µ–º –≤ –¥—Ä—É–≥–æ–π. –ï—Å—Ç—å –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã —á–∏—Ç–∞–µ–º —á–∏—Å–ª–∞, –Ω–∞–¥–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –Ω–∞–π—Ç–∏ –º–µ–¥–∏–∞–Ω—É —Å—Ä–µ–¥–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —á–∏—Å–µ–ª.

–ù–∞–¥–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```cpp
// –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –ø–æ—Ç–æ–∫–∞
void addNum(int num)
// –Ω–∞—Ö–æ–¥–∏—Ç –º–µ–¥–∏–∞–Ω—É —Å—Ä–µ–¥–∏ ¬´–ø—Ä–æ—à–µ–¥—à–∏—Ö —á–µ—Ä–µ–∑ addNum –∑–Ω–∞—á–µ–Ω–∏–π¬ª
double findMedian()
```

–ü—Ä–∏–º–µ—Ä:

```cpp
addNum(1)
addNum(2)
// —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É [1,2] ‚Äì> 1.5
findMedian() -> 1.5
addNum(3)
// —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É [1,2,3] ‚Äì> 2
findMedian() -> 2
```
    

[–ó–∞–¥–∞—á–∞ –Ω–∞ LeetCode](https://leetcode.com/problems/find-median-from-data-stream/).

–†–µ—à–µ–Ω–∏–µ¬†[#](#—Ä–µ—à–µ–Ω–∏–µ)
---------------------

–û—á–µ–≤–∏–¥–Ω–æ–µ –±—Ä—É—Ç—Ñ–æ—Ä—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å —á–∏—Å–ª–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é, –∏, –∫–æ–≥–¥–∞ –ø—Ä–æ—Å—è—Ç –Ω–∞–π—Ç–∏ –º–µ–¥–∏–∞–Ω—É, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ü–µ–Ω—Ç—Ä. –û–¥–Ω–∞–∫–æ, –≤ —É—Å–ª–æ–≤–∏–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ —Å–∫–∞–∑–∞–Ω–æ –ø—Ä–æ –ø–æ—Ç–æ–∫: —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±—É–¥–µ—Ç –≤—Å—ë –±–æ–ª—å—à–µ –∏ –±–æ–ª—å—à–µ, –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—ë –≤—Å—ë –¥–æ–ª—å—à–µ –∏ –¥–æ–ª—å—à–µ.

–ü–æ —Å—É—Ç–∏, –Ω–∞–º –∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ, –ø—Ä–æ—Å—Ç–æ —É –Ω–∞—Å –Ω–µ—Ç –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–π _—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö_, –∫–æ—Ç–æ—Ä–∞—è –±—ã –ø–æ–∑–≤–æ–ª—è–ª–∞ –Ω–∞–π—Ç–∏ ¬´—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç¬ª.

–•–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á ‚Äî –Ω–∞–π—Ç–∏ ¬´–±—É—Ç—ã–ª–æ—á–Ω–æ–µ –≥–æ—Ä–ª—ã—à–∫–æ¬ª. –í —á–µ–º –æ–Ω–æ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è —Å–µ–π—á–∞—Å? –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—á–µ—Ä–µ–¥–Ω–æ–π —á–∏—Å–ª–æ –Ω–∞–¥–æ –ø–æ–Ω—è—Ç—å –≤ –∫–∞–∫—É—é –ø–æ–ª–æ–≤–∏–Ω—É –æ–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è, –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –º–µ–¥–∏–∞–Ω—ã. –û–¥–Ω–∞–∫–æ, –Ω–∞–º –Ω–µ –Ω—É–∂–µ–Ω —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –º–µ–∂–¥—É _–≤—Å–µ–º–∏ —á–∏—Å–ª–∞–º–∏_.

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ —É –º—ã –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –ø–æ–¥–µ–ª–∏–ª–∏ —á–∏—Å–ª–∞ –Ω–∞ –¥–≤–µ –ø–æ–ª–æ–≤–∏–Ω—ã (—Å–ø–æ–π–ª–µ—Ä: –ø—Ä—è–º–æ —Ç–∞–∫ –∏ –ø—Ä–æ—Å–∏—Ç—Å—è —Å–ª–æ–≤–æ ¬´–∫—É—á–∞¬ª —Å—é–¥–∞). –ü—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–æ–µ —á–∏—Å–ª–æ. –°–º–æ—Ç—Ä–∏–º –ø—Ä–∏—â—É—Ä–µ–Ω–Ω—ã–º –≤–∑–≥–ª—è–¥–æ–º –Ω–∞ –∫—É—á–∏ –∏ –ø–æ–Ω–∏–º–∞–µ–º, —ç—Ç–æ —á–∏—Å–ª–æ —è–≤–Ω–æ –∏–¥—ë—Ç –≤ –±–æ–ª—å—à—É—é –∏–ª–∏ –º–µ–Ω—å—à—É—é –ø–æ–ª–æ–≤–∏–Ω—ã. –ù–∞–º –Ω–µ –Ω–∞–¥–æ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —á–∏—Å–ª–∞ –¥—Ä—É–≥ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥—Ä—É–≥–∞.

–ï—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫ –∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **heap** (–∫—É—á–∞) ‚Äî –¥–µ—Ä–µ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤ –∫–æ—Ä–Ω–µ —Ö—Ä–∞–Ω–∏—Ç –Ω–∞–∏–±–æ–ª—å—à–µ–µ –∏–ª–∏ –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —É–∑–ª–æ–≤. –°–ª–æ–∂–Ω–æ—Å—Ç—å –≤—Å—Ç–∞–≤–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤: `O(log N)`.

–ó–¥–µ—Å—å –º—ã –∏ –∏–∑–±–∞–≤–ª—è–µ–º—Å—è –æ—Ç ¬´–±—É—Ç—ã–ª–æ—á–Ω–æ–≥–æ –≥–æ—Ä–ª—ã—à–∫–∞¬ª ‚Äî `log N` –≤–º–µ—Å—Ç–æ `N * log N` –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ. –û—Ç–Ω–æ—à–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–µ—Ç, –≤–∞–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∫—É–¥–∞ –Ω–∞–¥–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π).

![](/images/find-median-from-data-stream--heaps.jpg)

–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ! –ó–∞–≤–æ–¥–∏–º –¥–≤–µ –∫—É—á–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∏—Ö —Ä–∞–∑–º–µ—Ä—ã –æ—Ç–ª–∏—á–∞—é—â–∏–º–∏—Å—è –Ω–µ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É.

–î–∞–ª–µ–µ –ø—Ä—è–º–æ –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –º–µ–¥–∏–∞–Ω—ã. –õ–∏–±–æ —Ä–∞–∑–º–µ—Ä—ã –∫—É—á –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, —Ç.–µ. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª —á—ë—Ç–Ω–æ–µ, –∏ —Ç–æ–≥–¥–∞ –Ω–∞–¥–æ –≤–∑—è—Ç—å –≤–µ—Ä—à–∏–Ω—ã –¥–µ—Ä–µ–≤—å–µ–≤ (–∑–∞ `O(1)`) –∏ –Ω–∞–π—Ç–∏ —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ. –õ–∏–±–æ —Ä–∞–∑–º–µ—Ä—ã –∫—É—á –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É, —Ç.–µ. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª –Ω–µ—á—ë—Ç–Ω–æ–µ, –∏ —Ç–æ–≥–¥–∞ –Ω–∞–¥–æ –≤–∑—è—Ç—å –≤–µ—Ä—à–∏–Ω—É –±–æÃÅ–ª—å—à–µ–≥–æ –¥–µ—Ä–µ–≤–∞.

> –ù–∞–ø–∏—Å–∞—Ç—å Heap –æ—Ç–ª–∏—á–Ω–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –Ω–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ —Å—Ç–æ–∏—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π. –í —Å–ª—É—á–∞–µ —Å JavaScript —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å ¬´–ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–ª–µ–¥—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å¬ª. –ì–ª–∞–≤–Ω–æ–µ –æ–±—Å—É–¥–∏—Ç—å –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–ú–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—à–µ—Å–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ C++.

```cpp
class MedianFinder {
private:
  // –¥–µ–ª–∏–º –≤—Å–µ —á–∏—Å–ª–∞ –Ω–∞ –¥–≤–µ –∫—É—á–∏: maxH –∏ minH,
  // –æ–¥–Ω–∞ –¥–µ—Ä–∂–∏—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –∫–æ—Ä–Ω–µ,
  // –∞ –¥—Ä—É–≥–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
  priority_queue<int> maxH;
  priority_queue<int, vector<int>, greater<int>> minH;
public:
  void addNum(int num) {
    // –Ω–µ —Ç–µ—Ä—è—è –æ–±—â–Ω–æ—Å—Ç–∏ –∑–∞–∫–∏–Ω–µ–º
    // –Ω–æ–≤–æ–µ —á–∏—Å–ª–æ –≤ –æ–¥–Ω—É –ø–æ–ª–æ–≤–∏–Ω—É
    maxH.push(num);
    // –≤–∑–∞–º–µ–Ω –ø–µ—Ä–µ–∫–∏–Ω–µ–º –≤–µ—Ä—à–∏–Ω—É
    // –≤ –¥—Ä—É–≥—É—é –ø–æ–ª–æ–≤–∏–Ω—É
    minH.push(maxH.top());
    // –Ω–µ –∑–∞–±—ã–≤–∞–µ–º —É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç,
    // —Ç.–∫. –ø–æ —Å–º—ã—Å–ª—É –æ–Ω
    // —Ç–µ–ø–µ—Ä—å –≤ –¥—Ä—É–≥–æ–π –∫—É—á–µ
    maxH.pop();

    // –Ω–∏ –æ–¥–Ω–∞ –∫—É—á–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ —Ä–∞—Å—Ç–∏ –±—ã—Å—Ç—Ä–µ–µ –¥—Ä—É–≥–æ–π,
    // —Ç.–∫. –º—ã –∫–∏–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ minH –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è,
    // —á—Ç–æ maxH –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ø—É—Å—Ç–µ–µ—Ç
    if (minH.size() > maxH.size()) {
      maxH.push(minH.top());
      minH.pop();
    }
  }
  
  double findMedian() {
    // —á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
    // –≤–æ–∑—å–º—ë–º —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ
    if (minH.size() == maxH.size()) {
      return (minH.top() + maxH.top()) / 2.0;
    }
    // –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
    // –≤–æ–∑—å–º—ë–º –≤–µ—Ä—à–∏–Ω—É –±–æ–ª—å—à–µ–≥–æ –¥–µ—Ä–µ–≤–∞
    // –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –º—ã –∑–Ω–∞–µ–º,
    // —á—Ç–æ –≤ –ª–µ–≤–æ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ –Ω–∞ 1 –±–æ–ª—å—à–µ
    return maxH.top();
  }
};
```

–ö—Ä–∞—Å–æ—Ç–∞! –ü–æ-–º–æ–µ–º—É, –¥–æ–≤–æ–ª—å–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

–°–ª–æ–∂–Ω–æ—Å—Ç—å ‚Äî –ª–æ–≥–∞—Ä–∏—Ñ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ª–∏–Ω–∏—è –ø–æ –ø–∞–º—è—Ç–∏. –£ –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å –¥–≤–∞ –ª—é–±–æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑–≤–∏—Ç–∏—è:

*   —á—Ç–æ –µ—Å–ª–∏ –≤—Å–µ —á–∏—Å–ª–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 –¥–æ 100?
*   —á—Ç–æ –µ—Å–ª–∏ 99% —á–∏—Å–µ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 –¥–æ 100?

> –°–ø–æ–π–ª–µ—Ä: bucket sort

PS. –û–±—Å—É–¥–∏—Ç—å –º–æ–∂–Ω–æ –≤ [—Ç–µ–ª–µ–≥—Ä–∞–º-—á–∞—Ç–µ](https://t.me/ctci_chat_ru) –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤. Welcome! ü§ó

–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ [–º–æ–π —Ç–≤–∏—Ç–µ—Ä](https://twitter.com/vitkarpov) –∏–ª–∏ [–∫–∞–Ω–∞–ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ](https://t.me/coding_interviews), —á—Ç–æ–±—ã —É–∑–Ω–∞–≤–∞—Ç—å –æ –Ω–æ–≤—ã—Ö —Ä–∞–∑–±–æ—Ä–∞—Ö –∑–∞–¥–∞—á.