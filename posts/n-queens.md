N Queens
========

Oct 12, 2020 ¬∑ 4 min read

–ù–∞–π—Ç–∏ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ N —Ñ–µ—Ä–∑–µ–π –Ω–∞ —à–∞—Ö–º–∞—Ç–Ω–æ–π –¥–æ—Å–∫–µ —Ä–∞–∑–º–µ—Ä–æ–º NxN —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∏ –æ–¥–Ω–∞ –∏–∑ —Ñ–∏–≥—É—Ä –Ω–µ –±—ã–ª–∞ –ø–æ–¥ –±–æ–µ–º –¥—Ä—É–≥–æ–π.

–û–¥–Ω–∏ –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç–∞–∫–æ–π —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ –¥–æ—Å–∫–µ —Ä–∞–∑–º–µ—Ä–æ–º 8x8:

![](/images/n-queens--8.jpg)

–ù–∞ –≤—Ö–æ–¥ –¥–∞—ë—Ç—Å—è `N`, –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–∞–∫–∏—Ö —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–æ–∫.

–ü—Ä–∏–º–µ—Ä –¥–ª—è `N = 4`:

    [
     [".Q..",  // Solution 1
      "...Q",
      "Q...",
      "..Q."],
    
     ["..Q.",  // Solution 2
      "Q...",
      "...Q",
      ".Q.."]
    ]
    

`Q` –æ–∑–Ω–∞—á–∞–µ—Ç —Ñ–µ—Ä–∑—è, –∞ `.` ‚Äì –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É.

[–ó–∞–¥–∞—á–∞ –Ω–∞ LeetCode](https://leetcode.com/problems/n-queens/).

–†–µ—à–µ–Ω–∏–µ¬†[#](#—Ä–µ—à–µ–Ω–∏–µ)
---------------------

–û—Ç–Ω–æ—à–µ–Ω–∏–µ –ª–∞–π–∫–æ–≤ –∫ –¥–∏–∑–ª–∞–π–∫–∞–º –Ω–∞–º–µ–∫–∞–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ —Ö–æ—Ä–æ—à–∞—è:

![](/images/n-queens--likes.jpg)

–¢–∞–∫ –∏ –µ—Å—Ç—å, —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ **backtracking**.

–ü–æ —Å—É—Ç–∏, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –Ω–∞–π—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏. –û–¥–Ω–∞–∫–æ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ–≥—Ä–æ–º–Ω–æ–µ!

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±—ã—á–Ω–æ–π –¥–æ—Å–∫–∏ (`N = 8`) –æ–Ω–æ —Ä–∞–≤–Ω–æ: `64!/(8!(64-8)!) ~= 4,426,165,368`, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–æ–µ **—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –∑–∞–¥–∞–Ω–Ω—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º**, –≤—Å–µ–≥–æ 92!

–í —ç—Ç–æ–º –∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è —Å—É—Ç—å –±–µ–∫—Ç—Ä–µ–∫–∏–Ω–≥–∞ ‚Äî –æ–±—Ö–æ–¥–∏—Ç—å –Ω–µ –≤—Å—ë –¥–µ—Ä–µ–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∞ —Å—Ä–∞–∑—É –æ—Ç—Ä–µ–∑–∞—Ç—å —Ç–µ –ø—É—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–µ–¥–æ–º–æ –Ω–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ —Ä–µ—à–µ–Ω–∏—é.

> –ü—Ä–æ [–±–µ–∫—Ç—Ä–µ–∫–∏–Ω–≥ –≤–æ–æ–±—â–µ](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B8%D1%81%D0%BA_%D1%81_%D0%B2%D0%BE%D0%B7%D0%B2%D1%80%D0%B0%D1%82%D0%BE%D0%BC) –∏ [–∑–∞–¥–∞—á—É –æ –≤–æ—Å—å–º–∏ —Ñ–µ—Ä–∑—è—Ö](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE_%D0%B2%D0%BE%D1%81%D1%8C%D0%BC%D0%B8_%D1%84%D0%B5%D1%80%D0%B7%D1%8F%D1%85) –Ω–∞ –í–∏–∫–∏–ø–µ–¥–∏–∏.

–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–π.

–°—Ç–∞–≤–∏–º –ø–µ—Ä–≤–æ–≥–æ —Ñ–µ—Ä–∑—è –Ω–∞ –ø–µ—Ä–≤—É—é –∫–ª–µ—Ç–∫—É –≤ –ø–µ—Ä–≤–æ–º —Ä—è–¥—É. –î–∞–ª–µ–µ –ø—Ä–æ–±—É–µ–º –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–µ—Ä–∑—è –Ω–∞ –≤—Ç–æ—Ä–æ–π —Ä—è–¥, —Ç.–∫. –≤–µ—Å—å –ø–µ—Ä–≤—ã–π —Ä—è–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥ —É–¥–∞—Ä–æ–º –ø–µ—Ä–≤–æ–≥–æ —Ñ–µ—Ä–∑—è. –°—Ç–∞–≤–∏–º –Ω–∞ –ø–µ—Ä–≤—É—é –∫–ª–µ—Ç–∫—É –∏‚Ä¶ –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ —Ñ–µ—Ä–∑—å –ø–æ–¥ —É–¥–∞—Ä–æ–º, –∞ –∑–Ω–∞—á–∏—Ç —ç—Ç–æ ¬´–º—ë—Ä—Ç–≤–∞—è¬ª –≤–µ—Ç–∫–∞ –¥–µ—Ä–µ–≤–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –∏–¥—Ç–∏ —Ç–æ—á–Ω–æ –Ω–µ —Å—Ç–æ–∏—Ç.

–°—Ç–∞–≤–∏–º –≤—Ç–æ—Ä–æ–≥–æ —Ñ–µ—Ä–∑—è –Ω–∞ –≤—Ç–æ—Ä—É—é –∫–ª–µ—Ç–∫—É, —Ç—Ä–µ—Ç—å—é –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë—Ç—Å—è ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è¬ª –∫–ª–µ—Ç–∫–∞ –≤ —ç—Ç–æ–º —Ä—è–¥—É. –ò —Ç–∞–∫ –¥–∞–ª–µ–µ —Å `k`\-–º —Ñ–µ—Ä–∑—ë–º –≤ `k`\-–º —Ä—è–¥—É ‚Äî –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞ ¬´–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å¬ª.

    /**
     * @param {number} n
     * @return {string[][]}
     */
    var solveNQueens = function(n) {
        const result = [];
        const board = [];
    
        // –±—É–¥–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å dfs,
        // –æ–±—Ö–æ–¥—è –¥–µ—Ä–µ–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        // –≤ board –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–µ—â—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ,
        // –≤ result ‚Äî –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        dfs(n, board, result);
        return result;
    };
    
    /**
     * –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏—Ç –¥–µ—Ä–µ–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤,
     * –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω—è—è –º–∞—Å—Å–∏–≤ –æ—Ç–≤–µ—Ç–æ–≤, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–æ —Å—Å—ã–ª–∫–µ.
     * @param {number} n
     * @param {number[]} board
     * @param {string[][]} result
     * @return {void}
     */
    function dfs(n, board, result) {
        // –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∫—É—Ä—Å–∏–∏:
        // –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –≤—Å—é –¥–æ—Å–∫—É n —Ñ–∏–≥—É—Ä–∞–º–∏,
        // –∑–Ω–∞—á–∏—Ç –Ω–∞–¥–æ –≤–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –æ—Ç–≤–µ—Ç,
        // –Ω–µ –∑–∞–±—ã–≤ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –Ω—É–∂–Ω—É—é –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —Å—Ç—Ä–æ–∫—É
        if (board.length === n) {
            result.push(serialize(board));
        } else {
            // –±–µ–∂–∏–º –ø–æ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º –∏
            // –ø—ã—Ç–∞–µ–º—Å—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–≥—É—Ä—É —Ç–∞–∫,
            // —á—Ç–æ–±—ã –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ
            // –¥—Ä—É–≥–∏—Ö —Ñ–∏–≥—É—Ä –±—ã–ª–æ –≤–∞–ª–∏–¥–Ω—ã–º
            for (let i = 0; i < n; i++) {
                // –∫–ª–∞–¥—ë–º –æ—á–µ—Ä–µ–¥–Ω—É—é —Ñ–∏–≥—É—Ä—É
                board.push(i);
                // –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –±—å—é—Ç –ª–∏ —Ñ–µ—Ä–∑–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞
                if (valid(board)) {
                    // –µ—Å–ª–∏ –Ω–∞—à–ª–∏ –≤–∞–ª–∏–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ
                    // –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ, –∞ –∏–º–µ–Ω–Ω–æ
                    // –ø—Ä–æ–±—É–µ–º –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–µ—Ä–∑—è
                    // –Ω–∞ –Ω–æ–≤–æ–º —Ä—è–¥—É
                    dfs(n, board, result);
                }
                // –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
                // —Å–Ω–∏–º–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–µ—Ä–∑—è
                board.pop();
            }
        }
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–µ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å,
     * —Ç.–µ. —á—Ç–æ —Ñ–µ—Ä–∑–∏ –Ω–µ –±—å—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
     * @param {number[]} board
     * @return {boolean}
     */
    function valid(board) {
        const queenY = board.length - 1;
        const queenX = board[board.length - 1];
    
        // –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ—Ö —Ñ–µ—Ä–∑–µ–π –ù–ï –≤–∫–ª—é—á–∞—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
        for (let y = 0; y < queenY; y++) {
            // (x, y) - —Ç–µ–∫—É—â–∏–π —Ñ–µ—Ä–∑—å
            // (queenX, queenY) ‚Äì –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–µ—Ä–∑—å
            const x = board[y];
            const dx = Math.abs(queenX - x);
            const dy = queenY - y;
    
            // –±—å—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –µ—Å–ª–∏:
            // dx == 0  ‚Äì —Å—Ç–æ—è—Ç –Ω–∞ –æ–¥–Ω–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            // dx == dy ‚Äì —Å—Ç–æ—è—Ç –Ω–∞ –æ–¥–Ω–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏
            if (dx == 0 || dx == dy) {
                return false;
            }
        }
        // –ü—Ä–æ–≤–µ—Ä–∏–ª–∏, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω —Ñ–µ—Ä–∑—å
        // –Ω–µ –±—å—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ.
        // –¢–∞–∫ –∂–µ –º—ã –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö
        // —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö,
        // —Ç.–µ. –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ—Ä–∑—è –≤–µ—Ä–Ω–æ, —á—Ç–æ
        // –æ–Ω –Ω–µ –±—å—ë—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–µ–±–µ,
        // –∞ –∑–Ω–∞—á–∏—Ç –∏ –≤—Å—ë –ø–æ–ª–µ –≤–∞–ª–∏–¥–Ω–æ–µ
        return true;
    }
    
    /**
     * –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–µ—Ä–∑–µ–π
     * –≤ —Å—Ç—Ä–æ–∫—É, —Å–æ–≥–ª–∞—Å–Ω–æ —Ñ–æ—Ä–º–∞—Ç—É –æ—Ç–≤–µ—Ç–∞.
     * @param {number[]} board
     * @return {string}
     */
    function serialize(board) {
        return board.map((queenX) => {
            const row = [];
            for (let x = 0; x < board.length; x++) {
                row.push(x === queenX ? 'Q' : '.')
            }
            return row.join('');
        });
    }
    

![](/images/n-queens--result.jpg)

–î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—à–∏—Ç—å [–∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –∑–∞–¥–∞—á—É](https://leetcode.com/problems/n-queens-ii/), —Ç–æ–ª—å–∫–æ –≤–µ—Ä–Ω—É—Ç—å –Ω—É–∂–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–æ–∫, –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ–º.

PS. –û–±—Å—É–¥–∏—Ç—å –º–æ–∂–Ω–æ –≤ [—Ç–µ–ª–µ–≥—Ä–∞–º-—á–∞—Ç–µ](https://t.me/ctci_chat_ru) –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤. Welcome! ü§ó

–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ [–º–æ–π —Ç–≤–∏—Ç–µ—Ä](https://twitter.com/vitkarpov) –∏–ª–∏ [–∫–∞–Ω–∞–ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ](https://t.me/coding_interviews), —á—Ç–æ–±—ã —É–∑–Ω–∞–≤–∞—Ç—å –æ –Ω–æ–≤—ã—Ö —Ä–∞–∑–±–æ—Ä–∞—Ö –∑–∞–¥–∞—á.