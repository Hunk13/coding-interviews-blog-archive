Html Entity Parser
==================

Nov 16, 2020 ¬∑ 3 min read

–ù—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å **–ø–∞—Ä—Å–µ—Ä** –º–Ω–µ–º–æ–Ω–∏–∫ HTML. –ù–∞ –≤—Ö–æ–¥ –ø–æ–¥–∞—ë—Ç—Å—è —Å—Ç—Ä–æ—á–∫–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –º–Ω–µ–º–æ–Ω–∏–∫–∞–º–∏:

*   _Quotation Mark_: `&quot;` => `"`
*   _Single Quote Mark_: `&apos;` => `'`
*   _Ampersand_: `&amp;` => `&`
*   _Greater Than Sign_: `&gt;` => `>`
*   _Less Than Sign_: `&lt;` => `<`
*   _Slash_: `&frasl;` => `/`

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –º–Ω–µ–º–æ–Ω–∏–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É—é—â–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏.

[–ó–∞–¥–∞—á–∞ –Ω–∞ LeetCode](https://leetcode.com/problems/html-entity-parser/).

–†–µ—à–µ–Ω–∏–µ¬†[#](#—Ä–µ—à–µ–Ω–∏–µ)
---------------------

–í —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ —Ä–µ—à–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞, –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫. –ü–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –Ω–µ —Å—Ç–æ–∏—Ç ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ã—á–Ω—ã—Ö `replace` –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ, —ç—Ç–∞ –∑–∞–¥–∞—á–∞ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä :-)

–ò—Ç–∞–∫, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ?

*   —Ä–∞–∑–±–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ—á–∫—É –Ω–∞ **—Ç–æ–∫–µ–Ω—ã**
*   –º–∞–ø–∏–º —Ç–æ–∫–µ–Ω—ã –Ω–∞ –Ω—É–∂–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —Å–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ù–∞—á–Ω—ë–º —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞. –ß—Ç–æ —ç—Ç–æ? –ü—Ä–æ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏. –í –¥–æ–±–∞–≤–æ–∫ –∫ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–º –≤ —É—Å–ª–æ–≤–∏–∏ –º–Ω–µ–º–æ–Ω–∏–∫–∞–º –º—ã –¥–æ–±–∞–≤–∏–º –µ—â—ë –æ–¥–Ω—É ‚Äî ¬´–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç¬ª, –∞ —Ç–∞–∫ –∂–µ –ø–æ–∑–∏—Ü–∏–∏ `start` –∏ `end`, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–π—Ç–∏ —Å—É—â–Ω–æ—Å—Ç—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ.

    class Token {
      constructor(entity, start, end) {
        this.entity = entity;
        this.start = start;
        this.end = end;
      }
    }
    

–ü—Ä–µ–∂–¥–µ, —á–µ–º –ø–∏—Å–∞—Ç—å —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä, –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

    /**
     * @param {string} text
     * @return {string}
     */
    var entityParser = function(text) {
      return tokenize(text)
        .map(token => {
          switch (token.entity) {
            case ENTITIES.TEXT:
              return text.substring(token.start, token.end);
            case ENTITIES.QUOTE:
              return '"';
            case ENTITIES.APOS:
              return "'";
            case ENTITIES.AMP:
              return "&";
            case ENTITIES.GT:
              return ">";
            case ENTITIES.LT:
              return "<";
            case ENTITIES.SLASH:
              return "/";
          }
        })
        .join("");
    };
    
    const ENTITIES = {
      QUOTE: 1,
      APOS: 2,
      AMP: 3,
      GT: 4,
      LT: 5,
      SLASH: 6,
      TEXT: 7
    };
    

> –¢–æ–∫–µ–Ω–∞–π–∑–µ—Ä —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä—Å–µ—Ä –∏–∑ —Ç–æ–∫–µ–Ω–æ–≤ —Å–æ–±–∏—Ä–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ (AST), —Å –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ —É–¥–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º (–Ω–∞–ø—Ä–∏–º–µ, –±–µ–∫–µ–Ω–¥–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞). –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –Ω–∞—à ¬´–ø–∞—Ä—Å–µ—Ä¬ª ‚Äî –≤—Å—ë —Å–æ–±–∏—Ä–∞–µ—Ç –≤ —Å—Ç—Ä–æ–∫—É, –∏ –Ω–∏–∫–∞–∫–æ–µ –¥–µ—Ä–µ–≤–æ –Ω–µ —Å—Ç—Ä–æ–∏—Ç.

–ò–º–µ–ª–æ –±—ã —Å–º—ã—Å–ª —Å–≤–µ—Ä–Ω—É—Ç—å —ç—Ç–æ—Ç switch-case –≤–æ —á—Ç–æ-—Ç–æ –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–µ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–¥–Ω–∞–∫–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω –º–æ–∂–µ—Ç –æ–±—Ä–∞–±—ã–≤–∞—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É, –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –º—ã –ª–∏–±–æ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–∏–º–≤–æ–ª, –ª–∏–±–æ –≤—ã—Ä–µ–∑–∞–µ–º –∫—É—Å–æ–∫ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏. –ì—Ä—É–±–æ –≥–æ–≤–æ—Ä—è, –≤—Å—ë, —á—Ç–æ –æ–∫—Ä—É–∂–∞–µ—Ç –º–Ω–µ–º–æ–Ω–∏–∫–∏ ‚Äî —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω.

–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–µ–º —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä. –°—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –±–µ–≥—É—Ç –ø–æ —Å—Ç—Ä–æ–∫–µ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –ª–æ–∫–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã.

    function tokenize(text) {
      // –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–∏–ø–æ–≤ —Ç–æ–∫–µ–Ω–∞
      // –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –º–Ω–µ–º–æ–Ω–∏–∫–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞
      const SUBSTR_TO_ENTITY = {
        "&quot;": ENTITIES.QUOTE,
        "&apos;": ENTITIES.APOS,
        "&amp;": ENTITIES.AMP,
        "&gt;": ENTITIES.GT,
        "&lt;": ENTITIES.LT,
        "&frasl;": ENTITIES.SLASH
      };
    
      const tokens = [];
      // –¥–≤–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç
      // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü —Ç–æ–∫–µ–Ω–∞
      let prev = 0;
      let curr = 0;
    
      while (curr < text.length) {
        // –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ &,
        // —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—á–∞–ª–æ–º –º–Ω–µ–º–æ–Ω–∏–∫–∏
        if (text[curr] === "&") {
          // –ø–æ–∏—â–µ–º –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–æ–Ω–µ—Ü,
          // +1 —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º —Å–∏–º–≤–æ–ª ";" –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª
          const end = text.indexOf(";", curr) + 1;
    
          // –µ—Å–ª–∏ ; –Ω–µ –Ω–∞—à–ª–æ—Å—å,
          // —Ç–æ —ç—Ç–æ –Ω–µ –º–Ω–µ–º–æ–Ω–∏–∫–∞ –≤–æ–≤—Å–µ,
          // –¥–µ–ª–∞—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ
          if (end === 0) {
            continue;
          }
          // –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω,
          // —Ç.–µ –≤—Å—ë –¥–æ "&"
          tokens.push(new Token(ENTITIES.TEXT, prev, curr));
    
          // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏
          const entity = SUBSTR_TO_ENTITY[text.substring(curr, end)];
    
          // –µ—Å–ª–∏ —Ç–∞–∫–∞—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç,
          // —Ç–æ –¥–æ–±–∞–≤–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω
          if (entity) {
            tokens.push(new Token(entity, curr, end));
    
          // –∏–Ω–∞—á–µ —ç—Ç–æ ¬´–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç¬ª,
          // –Ω–∞–ø—Ä–∏–º–µ—Ä, &foo; ‚Äì —ç—Ç–æ –Ω–µ –º–Ω–µ–º–æ–Ω–∏–∫–∞
          } else {
            tokens.push(new Token(ENTITIES.TEXT, curr, end));
          }
          // –æ–±–Ω–æ–≤–ª—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª–∏,
          // –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ ";" —Å–∏–º–≤–æ–ª,
          // —Ç.–µ. –≤—Å—ë, —á—Ç–æ –¥–æ –º—ã –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏
          curr = prev = end;
    
        // –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–≤–∏–≥–∞–µ–º –ø–æ —Å—Ç—Ä–æ–∫–µ,
        // –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë–º & –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –∫–æ–Ω—á–∏—Ç—Å—è
        } else {
          curr++;
        }
      }
      // –ù–µ –∑–∞–±—ã–≤–∞–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ö–≤–æ—Å—Ç,
      // curr –∑–¥–µ—Å—å –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
      // –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª–∞—Å—å –º–Ω–µ–º–æ–Ω–∏–∫–æ–π,
      // —Ç–æ prev —Ç–∞–∫ –∂–µ –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏,
      // –∏ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –Ω—É–ª–µ–≤–æ–π –¥–ª–∏–Ω—ã.
      // –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω–æ, –≤ –∏—Ç–æ–≥–µ, –≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.
      tokens.push(new Token(ENTITIES.TEXT, prev, curr));
      return tokens;
    }
    

![](/images/html-entity-parser--result.jpg)

PS. –û–±—Å—É–¥–∏—Ç—å –º–æ–∂–Ω–æ –≤ [—Ç–µ–ª–µ–≥—Ä–∞–º-—á–∞—Ç–µ](https://t.me/ctci_chat_ru) –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤. Welcome! ü§ó

–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ [–º–æ–π —Ç–≤–∏—Ç–µ—Ä](https://twitter.com/vitkarpov) –∏–ª–∏ [–∫–∞–Ω–∞–ª –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ](https://t.me/coding_interviews), —á—Ç–æ–±—ã —É–∑–Ω–∞–≤–∞—Ç—å –æ –Ω–æ–≤—ã—Ö —Ä–∞–∑–±–æ—Ä–∞—Ö –∑–∞–¥–∞—á.